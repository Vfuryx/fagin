var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,n=(e,t,a)=>new Promise(((r,o)=>{var n=e=>{try{l(a.next(e))}catch(t){o(t)}},s=e=>{try{l(a.throw(e))}catch(t){o(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,s);l((a=a.apply(e,t)).next())}));import{b as s,B as l}from"./index.89a9d4e0.js";import{h as i,g as d}from"./useForm.62bbed2c.js";import{z as p,bp as u,D as c,r as m,u as f,j as b,F as v,a1 as g,a5 as y,w as h,a4 as P,t as x}from"./vendor.5da97255.js";/* empty css              */import{aj as D}from"./index.ab59a04a.js";const j=[{title:"部门名称",dataIndex:"name",width:160,align:"left"},{title:"排序",dataIndex:"sort",width:50},{title:"状态",dataIndex:"status",width:80,customRender:({record:e})=>{const t=0!=~~e.status,a=t?"启用":"停用";return p(u,{color:t?"green":"red"},(()=>a))}},{title:"备注",dataIndex:"remark"},{title:"创建时间",dataIndex:"created_at",width:180}],w=[{field:"name",label:"部门名称",component:"Input",colProps:{span:8}},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"停用",value:0}]},colProps:{span:8}}],I=[{field:"name",label:"部门名称",component:"Input",required:!0},{field:"parent_id",label:"上级部门",component:"TreeSelect",defaultValue:0,componentProps:{replaceFields:{title:"name",key:"id",value:"id"},getPopupContainer:()=>document.body}},{field:"sort",label:"排序",defaultValue:100,component:"InputNumber",required:!0},{field:"status",label:"状态",component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"停用",value:0}]},required:!0},{label:"备注",field:"remark",component:"InputTextArea"}];var _,k;(k=_||(_={})).DeptList="/departments",k.CreateDept="/departments",k.UpdateDept="/departments/",k.DeleteDept="/departments/";const O=e=>D.get({url:_.DeptList,params:e}),R=e=>D.delete({url:_.DeleteDept+e.toString()});var S=c({emits:["success","register"],setup(e,{emit:p}){const u=m(!0),c=m(0),[j,{resetFields:w,setFieldsValue:k,updateSchema:R,validate:S}]=i({labelWidth:100,schemas:I,showActionButtonGroup:!1}),[F,{setModalProps:L,closeModal:V}]=s((e=>n(this,null,(function*(){w(),L({confirmLoading:!1}),u.value=!!(null==e?void 0:e.isUpdate),f(u)&&(c.value=e.record.id,k(((e,n)=>{for(var s in n||(n={}))a.call(n,s)&&o(e,s,n[s]);if(t)for(var s of t(n))r.call(n,s)&&o(e,s,n[s]);return e})({},e.record)));const n=yield O();n.unshift({id:0,parent_id:0,name:"顶级部门",sort:999,created_at:"",remark:"",status:1}),R({field:"parent_id",componentProps:{treeData:n}})})))),q=b((()=>f(u)?"编辑部门":"新增部门"));function B(){return n(this,null,(function*(){try{const t=yield S();if(L({confirmLoading:!0}),!t)return;const a=x({name:t.name||"",remark:t.remark||"",status:t.status||0,parent_id:t.parent_id||0,sort:t.sort||0});f(u)?yield((e,t)=>D.put({url:_.UpdateDept+e.toString(),params:t}))(c.value,a):yield(e=a,D.post({url:_.CreateDept,params:e})),V(),p("success")}finally{L({confirmLoading:!1})}var e}))}return(e,t)=>(v(),g(f(l),P(e.$attrs,{onRegister:f(F),title:f(q),onOk:B}),{default:y((()=>[h(f(d),{onRegister:f(j)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{S as _,j as c,R as d,O as g,w as s};
