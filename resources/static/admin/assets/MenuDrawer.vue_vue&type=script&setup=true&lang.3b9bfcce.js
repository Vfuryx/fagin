var e=Object.defineProperty,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,n=(e,t,l)=>new Promise(((a,o)=>{var n=e=>{try{r(l.next(e))}catch(t){o(t)}},i=e=>{try{r(l.throw(e))}catch(t){o(t)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,i);r((l=l.apply(e,t)).next())}));import{h as i,g as r}from"./useForm.152ab070.js";import{z as s,bp as u,D as p,r as d,j as c,u as m,F as f,a1 as b,a5 as v,w as h,a4 as y,t as w}from"./vendor.5da97255.js";/* empty css              */import{_,aj as P}from"./index.7037d70a.js";import{u as g,B as I}from"./index.18992b80.js";const S=[{title:"菜单名称",dataIndex:"title",width:200,align:"left"},{title:"图标",dataIndex:"icon",width:55,customRender:({record:e})=>s(_,{icon:e.icon})},{title:"权限标识",dataIndex:"permission",width:200},{title:"路径",dataIndex:"path"},{title:"组件",dataIndex:"component"},{title:"排序",dataIndex:"sort",width:50},{title:"状态",dataIndex:"status",width:60,customRender:({record:e})=>{const t=0!=~~e.status,l=t?"启用":"停用";return s(u,{color:t?"green":"red"},(()=>l))}},{title:"创建时间",dataIndex:"created_at",width:168}],x=e=>0===e,M=e=>1===e,R=e=>2===e,j=[{field:"title",label:"菜单名称",component:"Input",colProps:{span:8}},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"停用",value:0}]},colProps:{span:8}}],q=[{field:"type",label:"菜单类型",component:"RadioButtonGroup",defaultValue:0,componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1},{label:"按钮",value:2}]},colProps:{lg:24,md:24}},{field:"name",label:"名称",component:"Input",required:({values:e})=>!R(e.type),ifShow:({values:e})=>!R(e.type)},{field:"title",label:"标题",component:"Input",required:!0},{field:"parent_id",label:"上级菜单",component:"TreeSelect",defaultValue:0,required:({values:e})=>!x(e.type),componentProps:{replaceFields:{title:"title",key:"id",value:"id"},getPopupContainer:()=>document.body}},{field:"icon",label:"图标",component:"IconPicker",required:!0},{field:"path",label:"路由地址",component:"Input",required:!0,ifShow:!0},{field:"component",label:"组件路径",component:"Input",required:({values:e})=>!R(e.type),ifShow:({values:e})=>!R(e.type)},{field:"redirect",label:"重定向",component:"Input",required:!1,ifShow:({values:e})=>!R(e.type)},{field:"frame_src",label:"iframe 地址",component:"Input",required:!1,ifShow:({values:e})=>!R(e.type)},{field:"current_active",label:"激活菜单",component:"Input",required:!1,ifShow:({values:e})=>M(e.type)},{field:"permission",label:"权限标识",component:"Input",required:!0,ifShow:({values:e})=>!x(e.type)},{field:"method",label:"方法",component:"RadioButtonGroup",defaultValue:"GET",componentProps:{options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}]},ifShow:({values:e})=>R(e.type)},{field:"sort",label:"排序",component:"InputNumber",defaultValue:100,required:!0},{field:"status",label:"状态",component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}},{field:"is_no_cache",label:"是否缓存",component:"RadioButtonGroup",defaultValue:0,componentProps:{options:[{label:"是",value:0},{label:"否",value:1}]},ifShow:({values:e})=>M(e.type)},{field:"is_hide_child",label:"隐藏子菜单",component:"RadioButtonGroup",defaultValue:0,componentProps:{options:[{label:"是",value:1},{label:"否",value:0}]},ifShow:({values:e})=>M(e.type)},{field:"is_show",label:"是否显示",component:"RadioButtonGroup",defaultValue:0,componentProps:{options:[{label:"是",value:1},{label:"否",value:0}]},ifShow:({values:e})=>!R(e.type)}];var D,E;(E=D||(D={})).MenuAll="/menus/all",E.MenuList="/menus",E.MenuDetail="/menus/",E.CreateMenu="/menus",E.UpdateMenu="/menus/",E.DeleteMenu="/menus/";const G=e=>P.get({url:D.MenuList,params:e}),T=e=>P.delete({url:D.DeleteMenu+e.toString()});var O=p({emits:["success","register"],setup(e,{emit:s}){const u=d(!0),p=d(0),[_,{resetFields:S,setFieldsValue:x,updateSchema:M,validate:R}]=i({labelWidth:100,schemas:q,showActionButtonGroup:!1,baseColProps:{lg:12,md:24}}),[j,{setDrawerProps:E,closeDrawer:G}]=g((e=>n(this,null,(function*(){if(S(),E({confirmLoading:!1}),u.value=!!(null==e?void 0:e.isUpdate),m(u)){p.value=e.record.id;const n=yield(e=>P.get({url:D.MenuDetail+e.toString()}))(p.value);x(((e,n)=>{for(var i in n||(n={}))l.call(n,i)&&o(e,i,n[i]);if(t)for(var i of t(n))a.call(n,i)&&o(e,i,n[i]);return e})({},n))}const n=yield P.get({url:D.MenuAll});n.unshift({icon:"",id:0,parent_id:0,title:"顶级菜单"}),M({field:"parent_id",componentProps:{treeData:n}})})))),T=c((()=>m(u)?"编辑菜单":"新增菜单"));function O(){return n(this,null,(function*(){try{const t=yield R();if(E({confirmLoading:!0}),!t)return;const l=w({component:t.component||"",icon:t.icon||"",is_no_cache:t.is_no_cache||0,is_hide_child:t.is_hide_child||0,is_show:t.is_show||0,method:t.method,name:t.name||"",parent_id:t.parent_id||0,path:t.path||"",redirect:t.redirect||"",frame_src:t.frame_src||"",current_active:t.current_active||"",permission:t.permission||"",sort:t.sort||0,status:t.status||0,title:t.title||"",type:t.type||0});m(u)?yield((e,t)=>P.put({url:D.UpdateMenu+e.toString(),params:t}))(p.value,l):yield(e=l,P.post({url:D.CreateMenu,params:e})),G(),s("success")}finally{E({confirmLoading:!1})}var e}))}return(e,t)=>(f(),b(m(I),y(e.$attrs,{onRegister:m(j),showFooter:"",title:m(T),width:"50%",onOk:O}),{default:v((()=>[h(m(r),{onRegister:m(_)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{O as _,S as c,T as d,G as g,j as s};
