var E=Object.defineProperty;var w=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var S=(e,a,t)=>a in e?E(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,b=(e,a)=>{for(var t in a||(a={}))j.call(a,t)&&S(e,t,a[t]);if(w)for(var t of w(a))P.call(a,t)&&S(e,t,a[t]);return e};var g=(e,a,t)=>new Promise((n,i)=>{var m=l=>{try{d(t.next(l))}catch(c){i(c)}},p=l=>{try{d(t.throw(l))}catch(c){i(c)}},d=l=>l.done?n(l.value):Promise.resolve(l.value).then(m,p);d((t=t.apply(e,a)).next())});import{B as U}from"./BasicForm.f9b68d8c.js";import{u as G}from"./useForm.ff740053.js";import{z as v,bQ as L,A as M,r as h,u as s,j as T,B as A,a1 as V,a6 as _,w as k,a4 as q,t as B}from"./vendor.3850bdb6.js";/* empty css                */import{ay as r,i as z}from"./index.6d3ed4e5.js";import{P as O}from"./permCodeEnum.0c8982e3.js";import{a as $,B as H}from"./index.71a54c7b.js";import{_ as N}from"./Tree.vue_vue&type=style&index=0&lang.d5823234.js";var o;(function(e){e.RoleList="/roles",e.GetRoleDetail="/roles/",e.CreateRole="/roles",e.UpdateRole="/roles/",e.DeleteRole="/roles/",e.SetRoleStatus="/roles/",e.GetMenuAll="/roles/menus"})(o||(o={}));const ie=e=>r.get({url:o.RoleList,params:e}),Q=e=>r.get({url:o.GetRoleDetail+e.toString()}),W=e=>r.post({url:o.CreateRole,params:e}),J=(e,a)=>r.put({url:o.UpdateRole+e.toString(),params:a}),de=e=>r.delete({url:o.DeleteRole+e.toString()}),K=(e,a)=>r.put({url:o.SetRoleStatus+e.toString()+"/status",params:{status:a}}),X=()=>r.get({url:o.GetMenuAll}),ce=[{title:"\u7F16\u53F7",dataIndex:"id",width:100},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"name",width:200},{title:"\u89D2\u8272\u503C",dataIndex:"key",width:180},{title:"\u6392\u5E8F",dataIndex:"sort",width:50},{title:"\u72B6\u6001",dataIndex:"status",width:120,auth:O.AdminSystemRoleUpdateStatus,customRender:({record:e})=>e.key=="admin"?v("div",null,null):(Reflect.has(e,"pendingStatus")||(e.pendingStatus=!1),v(L,{checked:e.status===1,checkedChildren:"\u5DF2\u542F\u7528",unCheckedChildren:"\u5DF2\u7981\u7528",loading:e.pendingStatus,onChange(a){e.pendingStatus=!0;const t=a?1:0,{createMessage:n}=z();K(e.id,t).then(()=>{e.status=t,n.success("\u5DF2\u6210\u529F\u4FEE\u6539\u89D2\u8272\u72B6\u6001")}).catch(()=>{n.error("\u4FEE\u6539\u89D2\u8272\u72B6\u6001\u5931\u8D25")}).finally(()=>{e.pendingStatus=!1})}}))},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"created_at",width:180},{title:"\u5907\u6CE8",dataIndex:"remark"}],me=[{field:"name",label:"\u89D2\u8272\u540D\u79F0",component:"Input",colProps:{span:8}},{field:"status",label:"\u72B6\u6001",component:"Select",componentProps:{options:[{label:"\u542F\u7528",value:1},{label:"\u505C\u7528",value:0}]},colProps:{span:8}}],Y=[{field:"id",label:"\u7F16\u53F7",component:"Input",show:!1},{field:"name",label:"\u89D2\u8272\u540D\u79F0",required:!0,component:"Input"},{field:"key",label:"\u89D2\u8272\u503C",component:"Input",required:({values:e})=>!e.id,ifShow:({values:e})=>!e.id},{field:"status",label:"\u72B6\u6001",component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:"\u542F\u7528",value:1},{label:"\u505C\u7528",value:0}]}},{label:"\u5907\u6CE8",field:"remark",component:"InputTextArea"},{label:" ",field:"menu_ids",slot:"menu",component:"Input"}],Z=M({emits:["success","register"],setup(e,{emit:a}){const t=h(!0),n=h([]),i=h(0),[m,{resetFields:p,setFieldsValue:d,validate:l}]=G({labelWidth:90,schemas:Y,showActionButtonGroup:!1}),[c,{setDrawerProps:f,closeDrawer:y}]=$(u=>g(this,null,function*(){if(p(),f({confirmLoading:!1}),s(n).length===0&&(n.value=yield X()),t.value=!!(u==null?void 0:u.isUpdate),s(t)){i.value=u.record.id;const D=yield Q(i.value);d(b({},D))}})),C=T(()=>s(t)?"\u7F16\u8F91\u89D2\u8272":"\u65B0\u589E\u89D2\u8272");function x(){return g(this,null,function*(){try{const u=yield l();if(f({confirmLoading:!0}),!u)return;console.log(u),s(t)?yield J(i.value,B({name:u.name,remark:u.remark,status:u.status,menu_ids:u.menu_ids})):yield W(B({name:u.name,key:u.key,remark:u.remark,status:u.status,menu_ids:u.menu_ids})),y(),a("success")}finally{f({confirmLoading:!1})}})}return(u,D)=>(A(),V(s(H),q(u.$attrs,{onRegister:s(c),showFooter:"",title:s(C),width:"45%",onOk:x}),{default:_(()=>[k(s(U),{onRegister:s(m)},{menu:_(({model:F,field:R})=>[k(s(N),{value:F[R],"onUpdate:value":I=>F[R]=I,treeData:n.value,replaceFields:{title:"title",key:"id"},checkable:"",toolbar:"",title:"\u83DC\u5355\u5206\u914D"},null,8,["value","onUpdate:value","treeData"])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]))}});var pe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Z});export{pe as R,Z as _,ce as c,de as d,ie as g,me as s};
